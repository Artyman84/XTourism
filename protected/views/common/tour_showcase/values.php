    <div class="panel panel-default" style="padding: 35px;">    <?php $param = isset($user_id) ? ['user_id' => $user_id] : []; ?>    <?php $form = $this->beginWidget('CActiveForm', [        'action' => $this->createUrl('UserTourShowcase/saveValues', $param),        'htmlOptions' => [            'role' => 'form',            'method' => 'post',        ]    ]);?>    <div class="row">        <? $settings = $model->showcaseSettings(); ?>        <? $showcase = new \TSearch\ShowcaseTour($settings->operators); ?>        <div class="col-md-12 text-center"><h4>Город вылета <small>Туры будут выбираться с учетом этого города</small></h4></div>        <div class="col-md-12 form-group">                <label style="cursor: pointer;" for="showcase_departure_city_id">Город вылета</label>                <? $cities = $showcase->depCitiesList();?>                <?=CHtml::dropDownList('showcase[departure_city_id]', $model->dc_dir_id, $cities, ['class' => 'form-control', 'id' => 'showcase_departure_city_id']); ?>        </div>        <div class="col-md-12 text-center" style="margin-top: 35px;"><h4>Значения по умолчанию <small>Эти значения будут настроены в витрине сразу после ее загрузки</small></h4></div>        <div class="col-md-4 form-group">                <label style="cursor: pointer;" for="showcase_country_id">Страна</label>                <? $countries = $showcase->countriesList($model->dc_dir_id, $settings->countries);?>                <?=CHtml::dropDownList('showcase[country_id]', $settings->country, $countries, ['class' => 'form-control', 'id' => 'showcase_country_id', 'empty' => '']); ?>        </div>        <div class="col-md-4 form-group">                <label style="cursor: pointer;" for="showcase_resort_id">Курорт</label>                <?if( !($country = $settings->country) ) {                    $country = isset($countries[0]) ? $countries[0]->id : 0;                }?>                <? $resorts = $showcase->resortsList($model->dc_dir_id, $country); ?>                <?=CHtml::dropDownList('showcase[resort_id]', $settings->resort, $resorts, ['class' => 'form-control', 'id' => 'showcase_resort_id', 'empty' => '']); ?>        </div>        <div class="col-md-4 form-group">                <label style="cursor: pointer;" for="showcase_hotel_category_id">Категория отеля</label>                <? $categories = $showcase->categoriesList($model->dc_dir_id); ?>                <?=CHtml::dropDownList('showcase[hotel_category_id]', $settings->category, $categories, ['class' => 'form-control', 'id' => 'showcase_hotel_category_id', 'empty' => '']); ?>        </div>    </div>    <div class="row">        <div class="col-md-12">            <hr>            <button class="btn btn-primary btn-sm" type="submit" onclick="$.showFade();"><span class="glyphicon glyphicon-save"></span> Сохранить</button>        </div>    </div>    <?php $this->endWidget(); ?></div><?php$user_id = isset($user_id) ? $user_id : 0;$js = <<<JS    (function($){        var cdc_relations = {$showcase->countriesOfDepCities($settings->countries, true)};                $(function(){            $("#showcase_departure_city_id").change(function(){                var options = ['<option value=""></option>'];                var dep_city = "," + $(this).val() + ",";                var country = $("#showcase_country_id").val();                var j = 1;                var reload_resorts = true;                for(var i=0,l=cdc_relations.length; i<l; ++i) {                    if( cdc_relations[i].cities.indexOf(dep_city) != -1 ) {                                                var selected = '';                            if( country == cdc_relations[i].id ) {                            reload_resorts = false;                            selected = 'selected="selected"'                        }                        options[j++] = '<option value="' + cdc_relations[i].id + '" ' + selected + '>' + $.escapeHtml(cdc_relations[i].name) + '</option>';                    }                }                if( options.length ){                    $("#showcase_country_id").get(0).innerHTML = options.join("");                    if( reload_resorts ) {                        $("#showcase_country_id").trigger("change");                    }                } else {                    $("#showcase_resort_id, #showcase_country_id").html("");                }            });            $("#showcase_country_id").change(function(){                var country = $(this).val();                var options = ['<option value=""></option>'];                                if( parseInt(country) ) {                    $.sendRequest('UserTourShowcase/resortsByCountry', {'country_id': country, 'user_id': {$model->user_id}}, function(countries){                        for(var i=0,l=countries.length; i<l; ++i) {                            var selected = country == countries[i].id ? 'selected="selected"' : '';                            options[i+1] = '<option value="' + countries[i].id + '" ' + selected + '>' + $.escapeHtml(countries[i].name) + '</option>';                        }                            $("#showcase_resort_id").get(0).innerHTML = options.join("");                    });                } else {                    $("#showcase_resort_id").get(0).innerHTML = options.join("");                }            });                    })    })(jQuery);JS;Yii::app()->clientScript->registerScript( uniqid('showcase_'), $js, CClientScript::POS_READY );