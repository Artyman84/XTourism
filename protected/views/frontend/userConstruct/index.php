<?php/* @var $this SiteController */$this->breadcrumbs=array(    '<span class="fa fa-magic"></span> Конструктор лендингов');?><ul id="myTab" class="nav nav-pills" style="margin-bottom: 15px;">    <li <?=!$tab ? 'class="active"' : '' ?>>        <a href="#lp_builder_constructor" tab="builder" data-toggle="tab">Конструктор лендингов</a>    </li>    <li <?=$tab ? 'class="active"' : '' ?>>        <a href="#lp_builder_domain" tab="domain" data-toggle="tab">Домен</a>    </li></ul><div id="myTabContent" class="tab-content">    <div class="tab-pane fade <?=!$tab ? 'active in' : ''?>" id="lp_builder_constructor">        <div class="panel panel-default" style="padding: 35px 35px 35px 35px;" >            <div class="row" style="margin-bottom: 15px;">                <div class="col-md-4">                    <div class="form-group">                        <label class="control-label text-primary" style="cursor: pointer;" for="lp_builder_link">Адрес Вашего лендинга</label>                        <div class="input-group">                            <input type="text" style="cursor: pointer; font-weight: bold; font-size: 12px;" readonly class="form-control t-lp-builder-link" id="lp_builder_link" value="<?echo Yii::app()->params['lpBuilderHost'] . '/landings/' . Yii::app()->user->id?>">                            <span class="input-group-btn">                                <a href="<?echo Yii::app()->params['lpBuilderHost'] . '/landings/' . Yii::app()->user->id?>" class="btn btn-primary" type="button" target="_blank"><span class="glyphicon glyphicon-arrow-right"></span> Перейти</a>                            </span>                        </div>                    </div>                </div>            </div>            <div class="row" style="margin-bottom: 15px;">                <div class="col-md-4">                    <div class="form-group">                        <a href="<?echo Yii::app()->params['lpBuilderHost'];?>" class="btn btn-default t-openLPBuilder" type="button"><span class="fa fa-magic"></span> Открыть конструктор</a>                    </div>                </div>            </div>        </div>    </div>    <div class="tab-pane fade <?=$tab ? 'active in' : ''?>" id="lp_builder_domain">        <div class="panel panel-default" style="padding: 35px 35px 35px 35px;">            <div class="row" style="margin-bottom: 15px;">                <? if( !$userDomain ) {?>                    <div class="col-md-12 text-center">                        <p>Если у Вас еще нет домена для лендинга, тогда наш сервис предлагает Вам в кратчайшие сроки зарегистрировать свой домен.</p>                        <p>Для этого просто выберите подходящее свободное доменное имя и нажмите кнопку "Отправить заявку".</p>                        <p>После того, как Вы отправите заявку на домен, наш консультант свяжется с Вами для уточнения всех необходимых данных.</p>                    </div>                    <div class="col-md-offset-3 col-md-6 text-center" style="margin-top: 15px;">                        <div class="form-group">                            <label class="control-label" for="lp_builder_domain_name">Введите полное доменное имя (<small>пример: mail.ru, youtube.com</small>)</label>                            <div class="input-group">                                <input type="text" class="form-control" id="lp_builder_domain_name" value="">                                <span class="input-group-btn">                                    <a href="#" class="btn btn-primary t-check-domain" type="button" target="_blank"><span class="glyphicon glyphicon-search"></span> Проверить домен</a>                                </span>                            </div>                        </div>                        <p class="help-block">Наш механизм ищет доменные имена в наиболее распространенных доменных зонах. Для поиска по более расширенному списку доменных зон воспользуйтесь одним из сервисов в интернете.</p>                    </div>                    <div class="col-md-offset-3 col-md-6 text-center" style="margin-top: 15px;">                        <button type="button" class="btn btn-success t-send-domain-request"><span class="glyphicon glyphicon-ok"></span> Отправить заявку</button>                    </div>                    <script type="text/javascript">                        /*<![CDATA[*/                        jQuery(function($) {                            (function($){                                var clearDomainStatus = function(){                                    $(".t-check-domain").closest(".input-group").removeClass("has-success has-error").next().remove();                                };                                var setDomainStatus = function(status){                                    var $self = $(".t-check-domain");                                    if( !status ){                                        $self.closest(".input-group").addClass("has-success").after("<div class='text-success text-left'>Домен свободен!</div>");                                    } else {                                        var msg = {                                            "msg1": "Домен занят",                                            "msg2": "Доменное имя составлено не верно",                                            "msg3": "Доменное имя не может быть пустым",                                            "msg4": "Служба проверки домена временно не доступна",                                            "msg5": "Во время отправления заявки произошел сбой в системе, пожалуйста, обновите страницу и попробуйте еще раз"                                        };                                        $self.closest(".input-group").addClass("has-error").after("<div class='text-danger text-left'>" + msg["msg" + status] + ".</div>");                                    }                                };                                var checkDomainName = function(submit){                                    clearDomainStatus();                                    submit = submit !== "undefined" ? submit : false;                                    $.showFade();                                    $.sendRequest("UserConstruct/CheckDomain", {"domain_name": $("#lp_builder_domain_name").val()}, function(resp){                                        setDomainStatus(resp);                                        if( !resp && submit ){                                            sendDomainRequest();                                        } else {                                            $.hideFade();                                        }                                    }, null, false);                                };                                var sendDomainRequest = function(){                                    $.showFade();                                    $.sendRequest("UserConstruct/SendDomainRequest", {"domain_name": $("#lp_builder_domain_name").val()}, function(ret){                                        if(ret.error) {                                            $.hideFade();                                            clearDomainStatus();                                            setDomainStatus(5);                                        } else {                                            window.location.href = "<?=Yii::app()->createUrl("UserConstruct/Index", ['tab' => 1])?>";                                        }                                    }, null, false);                                };                                $(".t-check-domain").click(function(){                                    checkDomainName();                                    return false;                                });                                $(".t-send-domain-request").click(function(){                                    checkDomainName(1);                                    return false;                                });                            })($);                        });                        /*]]>*/                    </script>                <? } else {                    if( $userDomain->is_purchased && $userDomain->is_active ) { ?>                        <div class="col-md-12 text-center">                            <p><strong class="text-success">Ваш домен был успешно активирован!</strong></p>                            <p>Теперь всякий раз, когда Вы будете экспортировать лендинг, он автоматически будет виден на <a href="http://<?=CHtml::encode($userDomain->domain_name)?>" target="_blank"><?=CHtml::encode($userDomain->domain_name)?></a>.</p>                        </div>                    <? } else { ?>                        <div class="col-md-12 text-center">                            <p><strong class="text-success">Ваша заявка была успешно принята!</strong> Благодарим, что решили воспользоваться нашим сервисом для создания домена для Вашего лендинга.</p>                            <p>В ближайшее время наш консультант свяжется с Вами для уточнения всех необходимых данных.</p>                        </div>                    <? }                } ?>            </div>        </div>    </div></div><script type="text/javascript">    /*<![CDATA[*/    jQuery(function($) {        $("body").on("click", ".t-lp-builder-link", function(){            $(this).select();        });        $("body").on("click", ".t-openLPBuilder", function(){            $.navigate("<?echo Yii::app()->params['lpBuilderHost'] . '/?id=' . session_id();?>", true);            return false;        });    });    /*]]>*/</script>