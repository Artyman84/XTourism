<?php/** * Created by PhpStorm. * User: Arty * Date: 01.05.2015 * Time: 9:58 */class TPersonalMenu extends TPersonalBase {    public function run() {?>        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation-personal-menu">        <div class="container-fluid">            <div class="row">                <div class="col-sm-3 col-md-2">                    <div class="nav-justified">                        <a class="navbar-brand" href="<?php echo Yii::app()->createUrl('Welcome')?>"><?=Yii::app()->name?></a>                    </div>                </div>                <div class="col-sm-9 col-md-10">                    <div class="collapse navbar-collapse">                        <div class="nav navbar-nav pull-left">                            <ul class="nav navbar-nav">                                <li class="dropdown <?=$this->checkMenuItems([self::T_FMI_TOUR_SHOWCASE, self::T_FMI_TOUR_SEARCH, self::T_FMI_LP_BUILDER]) ? 'active' : ''?>">                                    <? $this->componentsMenu(); ?>                                </li>                                <? $this->tourRequestsItem(); ?>                                <li class="<?=($this->checkMenuItem(self::T_FMI_PROMOTION) ? ' active' : '')?>">                                    <a href="<?=Yii::app()->createUrl('Welcome/promotion')?>" ><span class="glyphicon glyphicon-gift"></span> Поисковик туров!</a>                                </li>                            </ul>                        </div><?php                        if( !Yii::app()->user->isGuest ){?>                            <div class="nav navbar-nav pull-right">                                <ul class="nav navbar-nav">                                    <li class="dropdown <?=($this->checkMenuItems([self::T_FMI_PROFILE, self::T_FMI_USER_PACKAGE, self::T_FMI_CONTACTS]) ? ' active' : '')?>">                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">                                            <span class="glyphicon glyphicon-user"></span>                                            <?php echo Yii::app()->user->name;?>: <?php echo ArUsers::roleName(Yii::app()->user->role);?><span class="caret"></span>                                        </a>                                        <ul class="dropdown-menu" role="menu">                                            <li <?=$this->checkMenuItem(self::T_FMI_PROFILE) ? 'class="active"' : ''?>>                                                <a tabindex="-3" href="<?=Yii::app()->createUrl('Users/profile')?>">                                                    <span class="glyphicon glyphicon-user i-margin"></span> Профайл</span>                                                </a>                                            </li>                                            <li class="<?=($this->checkMenuItem(self::T_FMI_USER_PACKAGE) ? ' active' : '')?>">                                                <a tabindex="-3" href="<?=Yii::app()->createUrl('Packages/userPackage')?>">                                                    <span class="flaticon-delivery-package-opened"></span> Пакет                                                </a>                                            </li>                                            <li class="divider"></li>                                            <li <?php echo ($this->checkMenuItem(self::T_FMI_CONTACTS) ? 'class="active"' : '') ?>>                                                <a tabindex="-2" href="<?php echo Yii::app()->createUrl('Welcome/support')?>">                                                    <span class="fa fa-support"></span>&nbsp;Техподдержка                                                </a>                                            </li>                                            <li class="divider"></li>                                            <li>                                                <a tabindex="-5" href="<?php echo Yii::app()->createUrl('welcome/logout');?>">                                                    <span class="text-danger"><span class="glyphicon glyphicon-log-out i-margin"></span> Выйти</span>                                                </a>                                            </li>                                        </ul>                                    </li>                                </ul>                            </div><?php                        }?>                    </div>                </div>            </div>        </div>        </nav><?$js = <<<JS    $('nav[role="navigation-personal-menu"] a[class!="dropdown-toggle"]').click(function(){        $.showFade();    });JS;        Yii::app()->clientScript->registerScript( 'nav-menu', $js, CClientScript::POS_READY );    }    /**     * Tours requests item     */    private function tourRequestsItem(){        if( $this->package && $this->package->isValid() && ($this->package->hasProduct(ArShopProductsTypes::PDT_TOUR_SHOWCASE) || $this->package->hasProduct(ArShopProductsTypes::PDT_SEARCHER)) ) {            $count = $this->getTourRequestCount();            $is_active = $this->checkMenuItem(self::T_FMI_CLIENTS_TOUR_REQUESTS); ?>            <li class="t-menu-tours-requests <?=$is_active ? 'active' : '' ?>">                <a tabindex="-2" href="<?= Yii::app()->createUrl('ToursRequests') ?>" <?=$count ? 'style="padding-right: 35px;"' : '' ?>>                    <span class="flaticon-phone-auricular-and-a-clock" style="position: relative; top: 1px;"></span> Заявки на туры                    <? if ($count) { ?>                        <div class="text-nowrap tour-request-count" style="color: #f0ad4e; font-size: 12px; position: absolute; top: 10px; left: 138px;">                            <span class="fa fa-plus" style="font-size: 10px;"></span>                            <strong><?=$count?></strong>                        </div>                    <? } ?>                </a>                </li><?        }    }    /**     * Renders components menu     */    private function componentsMenu() {        $package = Yii::app()->user->package;        if( $package && $package->isValid() ) { ?>            <a href="#" class="dropdown-toggle" data-toggle="dropdown">                <span class="fa fa-cubes"></span>&nbsp;Мои продукты<span class="caret"></span>            </a>            <ul class="dropdown-menu" role="menu">                <?php if ( $package->hasProduct(ArShopProductsTypes::PDT_TOUR_SHOWCASE) ) { ?>                    <li <?=$this->checkProductMenuItem('tour_showcase') ? 'class="active"' : ''?>>                        <a tabindex="-3" href="<?php echo Yii::app()->createUrl('UserTourShowcase'); ?>">                            <span class="glyphicon glyphicon-th"></span>                            Витрина туров                        </a>                    </li>                <? } ?>                <?php if ( $package->hasproduct(ArShopProductsTypes::PDT_HOTELS_SHOWCASE) ) { ?>                    <li <?=$this->checkProductMenuItem('hotel_showcase') ? 'class="active"' : ''?>>                        <a tabindex="-3" href="<?php echo Yii::app()->createUrl('UserHotelShowcase'); ?>">                            <span class="fa fa-building i-margin"></span>                            Витрина отелей                        </a>                    </li>                <? } ?>                <?php if ( $package->hasProduct(ArShopProductsTypes::PDT_SEARCHER) ) { ?>                    <li <?=$this->checkProductMenuItem('searcher') ? 'class="active"' : ''?>>                        <a tabindex="-3" href="<?php echo Yii::app()->createUrl('UserSearcher'); ?>">                            <span class="glyphicon glyphicon-search"></span>                            Поисковик туров                        </a>                    </li>                <? } ?>                <?php if ( $package->hasProduct(ArShopProductsTypes::PDT_LP_BUILDER) ) { ?>                    <li <?=$this->checkProductMenuItem('lp_builder') ? 'class="active"' : ''?>>                        <a tabindex="-3" href="<?php echo Yii::app()->createUrl('UserConstruct'); ?>">                            <span class="fa fa-magic i-margin"></span>                            Конструктор лендингов                        </a>                    </li>                <? } ?>            </ul><?        }    }    /**     * Overrides parent function     * @param string $product_type     * @return bool|mixed     */    private function checkProductMenuItem($product_type){        switch($product_type){            case 'tour_showcase': return $this->checkMenuItem(self::T_FMI_TOUR_SHOWCASE);            case 'hotel_showcase': return $this->checkMenuItem(self::T_FMI_HOTEL_SHOWCASE);            case 'searcher': return $this->checkMenuItem(self::T_FMI_TOUR_SEARCH);            case 'lp_builder': return $this->checkMenuItem(self::T_FMI_LP_BUILDER);            default: return false;        }    }}