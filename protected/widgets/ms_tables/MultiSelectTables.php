<?php/** * Created by Arty on 10.06.2017. *//** * Class MultiSelectTables */class MultiSelectTables extends CWidget {    /**     * Simple list of selected elements: [id => name]     * @var array     */    public $selectedElements = [];    /**     * Simple list of all elements: [id => name]     * @var array     */    public $allElements = [];    /**     * Hidden name of selected elements     * @var array     */    public $hidden_name = 'selected_elements[]';    /**     * Enables validation on selected elements     * @var bool     */    public $enable_validation = false;    /**     * Error message for validation     * @var bool     */    public $error_message;    /**     * Init     */    public function init(){        // Registers scripts        $basePath=Yii::getPathOfAlias('widgets.ms_tables.assets');        $baseUrl = Yii::app()->getAssetManager()->publish($basePath);        $cs=Yii::app()->getClientScript();        $cs->registerCssFile($baseUrl . '/ms_tables.css');        $cs->registerScriptFile($baseUrl . '/ms_tables.js');        // Set validation message        if( $this->enable_validation && !$this->error_message ) {            $this->error_message = 'Необходимо выброть хотя бы один объект.';        }        // Sets script's data and create js object ms_tables        $settings = [            'wrapper_id' => $this->getId(),            'hidden_name' => $this->hidden_name,            'hidden_id' => str_replace('[]', '', $this->hidden_name),            'enable_validation' => $this->enable_validation        ];        $cs->registerScript(            uniqid(),            'window.ms_tables = new window.ms_tables(' . CJSON::encode($settings) . ');',            CClientScript::POS_READY        );        parent::init();    }    /**     * Run     */    public function run(){?>        <div id="<?=$this->getId()?>" class="row">            <div class="col-md-6 col-sm-6 col-xs-6">                <table class="table table-unbordered table-condensed table-hovered panel-table table-striped table-multiselect">                    <thead class="head-selected-elements">                    <tr>                        <th><span class="t-selected-count"><?=count($this->selectedElements)?></span> объекта выбрано</th>                        <th><a class="t-delete-all" href="#">Удалить все</a></th>                    </tr>                    </thead>                    <tbody class="t-selected-elements">                    <? $i=1; foreach ($this->selectedElements as $id => $name) {?>                        <tr id="<?=$id?>">                            <td><?=$i++;?></td>                            <td><?=CHtml::encode($name)?><?=CHtml::hiddenField($this->hidden_name, $id, ['id' => str_replace('[]', '', $this->hidden_name) . '_' . $id])?></td>                            <td><a href="#" class="text-danger t-delete-one"><span class="glyphicon glyphicon-minus-sign"></span></a></td>                        </tr>                    <? } ?>                    </tbody>                </table>                <? if( $this->enable_validation ) {?>                    <div class="text-danger no-objects-error" style="display: none;"><hr><?=CHtml::encode($this->error_message)?></div>                <? } ?>            </div>            <div class="col-md-6 col-sm-6 col-xs-6">                <table class="table table-unbordered table-condensed table-hovered panel-table table-striped table-multiselect scroll">                    <thead class="head-all-elements">                    <tr>                        <th>                            <div class="has-feedback">                                <input class="t-element-filter form-control input-sm" type="text">                                <span class="glyphicon glyphicon-search form-control-feedback"></span>                            </div>                        </th>                        <th><a class="t-select-all" href="#">Выбрать все</a></th>                    </tr>                    </thead>                    <tbody class="t-all-elements">                    <? $i=1; foreach ($this->allElements as $id => $name) {?>                        <? $is_checked = isset($this->selectedElements[$id]); ?>                        <tr id="<?=$id?>" <?=$is_checked ? 'class="checked-element"' : ''?>>                            <td><?=$i++;?></td>                            <td><?=CHtml::encode($name)?></td>                            <td><a href="#" class="text-success t-select-one"><span class="glyphicon <?=$is_checked ? 'glyphicon-ok' : 'glyphicon-plus-sign'?>"></span></a></td>                        </tr>                    <? } ?>                    </tbody>                </table>            </div>        </div><?    }}