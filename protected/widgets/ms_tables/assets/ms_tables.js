/** * Created by Arty on 10.06.2017. */;(function($, undefined){    window.ms_tables = function(settings) {        var wrapperId = '#' + settings['wrapper_id'];        var $ms_wrapper = $(wrapperId);        var self = this;        self.reCountSelectedChildren = function () {            $(".t-selected-elements tr", $ms_wrapper).each(function (i) {                $(this).find("td:first").text(i + 1);            });        }        self.refreshSelectedCounter = function () {            $(".t-selected-count", $ms_wrapper).text($(".t-selected-elements tr", $ms_wrapper).length);        }        self.getChildrenResorts = function () {            var children = [];            $(".t-selected-elements tr", $ms_wrapper).each(function () {                children[children.length] = $(this).attr("id")            });            return children;        }        self.validateMsTables = function(){            if( settings['enable_validation'] ) {                if ($(".t-selected-elements tr", $ms_wrapper).length) {                    $(".no-objects-error", $ms_wrapper).hide();                    return true;                } else {                    $(".no-objects-error", $ms_wrapper).show();                    return false;                }            }            return null;        }        var selectChildrenResorts = function (children) {            var trs = [];            var len = $(".t-selected-elements tr", $ms_wrapper).length + 1;            for (var i = 0, l = children.length; i < l; ++i) {                var id = children[i];                var name = $(".t-all-elements tr[id='" + id + "'] td:eq(1)", $ms_wrapper).text();                if (!$(".t-selected-elements tr[id='" + id + "']", $ms_wrapper).length) {                    trs[i] = "<tr id='" + id + "'><td>" + (len + i) + "</td><td>" + name + "<input type='hidden' value='" + id + "' name='" + settings['hidden_name'] + "' id='" + settings['hidden_id'] + "_" + id + "'/></td><td><a href='#' class='text-danger t-delete-one'><span class='glyphicon glyphicon-minus-sign'></span></a></td></tr>";                    $(".t-all-elements tr[id='" + id + "']", $ms_wrapper).addClass("checked-element");                    $(".t-all-elements tr[id='" + id + "'] td:eq(2) span", $ms_wrapper).removeClass("glyphicon-plus-sign").addClass("glyphicon-ok");                }            }            $(".t-selected-elements", $ms_wrapper).append(trs.join(""));            self.refreshSelectedCounter();            self.validateMsTables();        }        var deleteChildrenResorts = function (children) {            for (var i = 0, l = children.length; i < l; ++i) {                var id = children[i];                var $tr = $(".t-all-elements tr[id='" + id + "']", $ms_wrapper);                if ($tr.length) {                    $tr.removeClass("checked-element");                    $tr.find("td:eq(2) span").removeClass("glyphicon-ok").addClass("glyphicon-plus-sign");                }                $(".t-selected-elements tr[id='" + id + "']", $ms_wrapper).remove();            }            self.reCountSelectedChildren();            self.refreshSelectedCounter();            self.validateMsTables();        }        $(function () {            $("body").on("click", wrapperId + " .t-select-all", function () {                var children = [];                $(".t-all-elements tr", $ms_wrapper).each(function () {                    children[children.length] = $(this).attr("id")                });                selectChildrenResorts(children);                return false;            });            $("body").on("click", wrapperId + " .t-select-one", function () {                selectChildrenResorts([$(this).closest("tr").attr("id")]);                return false;            });            $("body").on("dblclick", wrapperId + " .t-all-elements tr[class!='checked-element']", function () {                selectChildrenResorts([$(this).attr("id")]);            });            $("body").on("click", wrapperId + " .t-delete-all", function () {                deleteChildrenResorts(self.getChildrenResorts());                return false;            });            $("body").on("click", wrapperId + " .t-delete-one", function () {                deleteChildrenResorts([$(this).closest("tr").attr("id")]);                return false;            });            $("body").on("dblclick", wrapperId + " .t-selected-elements tr", function () {                deleteChildrenResorts([$(this).attr("id")]);            });            var searchTimer = null;            $("body").on("keyup", wrapperId + " .t-element-filter", function (e) {                var searchText = $(this).val();                var matcher = searchText ? new RegExp(searchText.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"), "i") : null;                clearTimeout(searchTimer);                searchTimer = setTimeout(function () {                    var i = 1;                    $(".t-all-elements tr").each(function () {                        var name = $.trim($(this).find("td:eq(1)").text());                        if ((!matcher || matcher.test(name))) {                            $(this).find("td:first").text(i++);                            $(this).css("display", "");                        } else {                            $(this).css("display", "none");                        }                    });                }, 170);            });        })    }})(jQuery);